import { useState, useEffect } from 'react'
import './App.css'

// Google Sheet ID
const SHEET_ID = '1mgeVYCf9a9zuEla6YfbNqceOsBRXA08YOc3rGuZtDx8'

// Login credentials
const ADMIN_USER = 'admin'
const ADMIN_PASS = 'admin123'

// Link column names
const LINK_COLUMN_NAMES = ['è©³ç´°ç™»éŒ²', 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', 'åˆ©ç”¨æ¡ˆå†…æ›¸']

// Parse CSV more robustly - handle quoted fields containing commas
const parseCSVLine = (line) => {
  const result = []
  let current = ''
  let inQuotes = false
  
  for (let i = 0; i < line.length; i++) {
    const char = line[i]
    
    if (char === '"') {
      if (inQuotes && line[i + 1] === '"') {
        current += '"'
        i++
      } else {
        inQuotes = !inQuotes
      }
    } else if (char === ',' && !inQuotes) {
      result.push(current)
      current = ''
    } else {
      current += char
    }
  }
  
  result.push(current)
  return result.map(val => val.trim().replace(/^"|"$/g, '').replace(/""/g, '"'))
}

function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false)
  const [username, setUsername] = useState('')
  const [password, setPassword] = useState('')
  const [loginError, setLoginError] = useState('')
  const [data, setData] = useState([])
  const [columns, setColumns] = useState([])
  const [loading, setLoading] = useState(false)
  const [filterText, setFilterText] = useState('')
  // Default selected: åˆ©ç”¨è€…ç™»éŒ²æ¸ˆ and ç”³è¾¼æ¸ˆ
  const [statusFilter, setStatusFilter] = useState(['åˆ©ç”¨è€…ç™»éŒ²æ¸ˆ', 'ç”³è¾¼æ¸ˆ'])
  const [hotelFilter, setHotelFilter] = useState('')
  const [hidePastDates, setHidePastDates] = useState(true)
  const [currentPage, setCurrentPage] = useState(1)
  const rowsPerPage = 20
  const [showLinkErrorInfo, setShowLinkErrorInfo] = useState(false)

  // Check login status on mount
  useEffect(() => {
    const session = sessionStorage.getItem('yoyaku_session')
    if (session) {
      setIsLoggedIn(true)
      fetchData()
    }
  }, [])

  // Define helper function first (before it's used)
  const isPastDate = (dateStr) => {
    if (!dateStr || typeof dateStr !== 'string' || !dateStr.trim()) return false
    
    try {
      let normalized = String(dateStr).trim()
      
      if (normalized.includes(' ')) {
        normalized = normalized.split(' ')[0]
      }
      
      if (normalized.includes('å¹´')) {
        normalized = normalized.replace(/å¹´/g, '-').replace(/æœˆ/g, '-').replace(/æ—¥/g, '')
      }
      
      normalized = normalized.replace(/-/g, '/')
      
      const parts = normalized.split('/')
      if (parts.length >= 3) {
        const year = parseInt(parts[0])
        const month = parseInt(parts[1]) - 1
        const day = parseInt(parts[2])
        
        if (year && month >= 0 && month <= 11 && day > 0) {
          const date = new Date(year, month, day)
          const today = new Date()
          today.setHours(0, 0, 0, 0)
          
          const checkDate = new Date(date)
          checkDate.setHours(0, 0, 0, 0)
          
          return checkDate < today
        }
      }
      
      return false
    } catch (e) {
      console.warn('Failed to parse date:', dateStr, e)
      return false
    }
  }

  // Compute filtered data using useMemo-like pattern but simpler
  const getFilteredData = () => {
    let filtered = [...data]
    
    if (hidePastDates && data.length > 0) {
      filtered = filtered.filter(item => {
        const stayDate = item['å®¿æ³Šæ—¥'] || ''
        return !isPastDate(stayDate)
      })
      console.log(`Hide past dates: ${data.length} â†’ ${filtered.length}`)
    }
    
    if (statusFilter.length > 0) {
      filtered = filtered.filter(item => statusFilter.includes(item['çŠ¶æ…‹']))
    }
    
    if (hotelFilter) {
      filtered = filtered.filter(item => item['ãƒ›ãƒ†ãƒ«'] === hotelFilter)
    }
    
    if (filterText) {
      filtered = filtered.filter(item => 
        Object.values(item).some(value =>
          String(value).toLowerCase().includes(filterText.toLowerCase())
        )
      )
    }
    
    return filtered
  }

  // Call the function and store results in variables
  const filteredData = getFilteredData()
  const totalPages = Math.ceil(filteredData.length / rowsPerPage)
  const paginatedData = filteredData.slice(
    (currentPage - 1) * rowsPerPage,
    currentPage * rowsPerPage
  )

  const hotels = [...new Set(data.map(d => d['ãƒ›ãƒ†ãƒ«']).filter(Boolean))]
  const statuses = [...new Set(data.map(d => d['çŠ¶æ…‹']).filter(Boolean))]

  // Render cell content
  const renderCell = (value, columnName, row) => {
    if (LINK_COLUMN_NAMES.includes(columnName)) {
      const urlProp = `${columnName}_url`
      
      let url = row?.[urlProp] || ''
      
      if (!url && typeof value === 'string') {
        const directUrlMatch = value.match(/@\s*(https?:\/\/[^\s]+)/i)
        if (directUrlMatch) {
          url = directUrlMatch[1]
        }
      }
      
      if (url && url.startsWith('http')) {
        return (
          <a 
            href={url}
            target="_blank"
            rel="noopener noreferrer"
            className="text-blue-600 hover:text-blue-800 underline cursor-pointer font-medium"
            title={`Open ${columnName}`}
          >
            @{' '}â–¼
          </a>
        )
      } else if (value && value.trim()) {
        return (
          <span 
            className="inline-flex items-center text-yellow-600 cursor-pointer hover:text-yellow-800"
            onClick={() => setShowLinkErrorInfo(!showLinkErrorInfo)}
            title="Click for debug info"
          >
            âš ï¸ 
          </span>
        )
      } else {
        return <span>&nbsp;</span>
      }
    }
    
    return <span>{value}</span>
  }

  // Fetch data from Google Sheets - supports both CSV and _URL columns
  const fetchData = async () => {
    setLoading(true)
    try {
      console.log('Fetching data from Google Sheets:', SHEET_ID)
      
      // Use Visualization API to get formatted data including links
      const queryUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=0`
      
      const response = await fetch(queryUrl)
      const text = await response.text()
      
      console.log('Raw response length:', text.length)
      
      // Parse Google Visualization API response format
      // Format: "/*O_o*/ google.visualization.Query.setResponse({...});"
      let jsonMatch = text.match(/\{\s*"version"\s*:\s*[\d.]+\s*\}/)
      
      if (!jsonMatch) {
        // Try alternate pattern without leading garbage
        const cleanMatch = text.match(/google\.visualization\.Query\.setResponse\(([^)]+)\)/s)
        if (cleanMatch) {
          jsonMatch = [cleanMatch[1]]
        } else {
          throw new Error('Invalid response format from Google Sheets')
        }
      }
      
      console.log('JSON match found, length:', jsonMatch[0].length)
      
      const jsonStr = jsonMatch[0]
      const jsonData = JSON.parse(jsonStr)
      
      console.log('Successfully parsed JSON, rows:', jsonData.table.rows?.length || 0)
      
      // Extract headers
      const headers = jsonData.table.cols.map(col => col.label)
      setColumns(headers)
      
      console.log('Headers:', headers.length, 'columns')
      
      // Check for URL columns (æ–¹æ¡ˆ A support)
      const urlColumnMapping = {}
      LINK_COLUMN_NAMES.forEach(linkCol => {
        const urlColIndex = headers.indexOf(`${linkCol}_URL`)
        if (urlColIndex !== -1) {
          urlColumnMapping[linkCol] = `${linkCol}_URL`
          console.log(`Found ${linkCol}_URL column at index ${urlColIndex}`)
        }
      })
      
      // Process rows
      const records = []
      jsonData.table.rows.forEach((row, rowIndex) => {
        const record = {}
        
        row.c.forEach((cell, colIndex) => {
          const header = headers[colIndex]
          
          if (cell === null) {
            record[header] = ''
            return
          }
          
          let value = cell.v || ''
          record[header] = value
          
          // If this is a _URL column, also store it with the original column name + _url suffix
          if (header.endsWith('_URL')) {
            const baseName = header.replace('_URL', '')
            record[`${baseName}_url`] = value
          }
          
          // Check if this is a link column
          if (LINK_COLUMN_NAMES.includes(header)) {
            // Priority 1: Get URL from corresponding _URL column
            const urlColumnName = `${header}_URL`
            const urlColData = row.c.find(c => headers[row.c.indexOf(c)] === urlColumnName)
            
            if (urlColData && urlColData.v) {
              record[`${header}_url`] = urlColData.v
              console.log(`Extracted URL for ${header}:`, urlColData.v)
            } else {
              // Fallback: Try HTML formatted version (old method)
              if (cell.f && cell.f.includes('<a')) {
                const urlMatch = cell.f.match(/<a\s+(?:[^>]*?\s+)?href="([^"]*)"/i)
                if (urlMatch) {
                  record[`${header}_url`] = urlMatch[1]
                  console.log(`Fallback: Extracted URL from HTML:`, urlMatch[1])
                }
              }
            }
          }
        })
        
        record._id = rowIndex + 1
        records.push(record)
      })
      
      console.log(`Parsed ${records.length} records`)
      setData(records)
      setCurrentPage(1)
    } catch (error) {
      console.error('Error fetching data:', error)
      alert('ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\nã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:\n' + error.message)
      setLoading(false)
    } finally {
      setLoading(false)
    }
  }

  // Check if date is in the past
  const isPastDate = (dateStr) => {
    if (!dateStr || typeof dateStr !== 'string' || !dateStr.trim()) return false
    
    try {
      let normalized = String(dateStr).trim()
      
      if (normalized.includes(' ')) {
        normalized = normalized.split(' ')[0]
      }
      
      if (normalized.includes('å¹´')) {
        normalized = normalized.replace(/å¹´/g, '-').replace(/æœˆ/g, '-').replace(/æ—¥/g, '')
      }
      
      normalized = normalized.replace(/-/g, '/')
      
      const parts = normalized.split('/')
      if (parts.length >= 3) {
        const year = parseInt(parts[0])
        const month = parseInt(parts[1]) - 1
        const day = parseInt(parts[2])
        
        if (year && month >= 0 && month <= 11 && day > 0) {
          const date = new Date(year, month, day)
          const today = new Date()
          today.setHours(0, 0, 0, 0)
          
          const checkDate = new Date(date)
          checkDate.setHours(0, 0, 0, 0)
          
          return checkDate < today
        }
      }
      
      return false
    } catch (e) {
      console.warn('Failed to parse date:', dateStr, e)
      return false
    }
  }

  // Get filtered data
  const getFilteredData = () => {
    let filtered = [...data]
    
    if (hidePastDates && data.length > 0) {
      filtered = filtered.filter(item => {
        const stayDate = item['å®¿æ³Šæ—¥'] || ''
        return !isPastDate(stayDate)
      })
      console.log(`Hide past dates: ${data.length} â†’ ${filtered.length}`)
    }
    
    if (statusFilter.length > 0) {
      filtered = filtered.filter(item => statusFilter.includes(item['çŠ¶æ…‹']))
    }
    
    if (hotelFilter) {
      filtered = filtered.filter(item => item['ãƒ›ãƒ†ãƒ«'] === hotelFilter)
    }
    
    if (filterText) {
      filtered = filtered.filter(item => 
        Object.values(item).some(value =>
          String(value).toLowerCase().includes(filterText.toLowerCase())
        )
      )
    }
    
    return filtered
  }

  const filteredData = getFilteredData()
  const totalPages = Math.ceil(filteredData.length / rowsPerPage)
  const paginatedData = filteredData.slice(
    (currentPage - 1) * rowsPerPage,
    currentPage * rowsPerPage
  )

  const hotels = [...new Set(data.map(d => d['ãƒ›ãƒ†ãƒ«']).filter(Boolean))]
  const statuses = [...new Set(data.map(d => d['çŠ¶æ…‹']).filter(Boolean))]

  // Render cell content
  const renderCell = (value, columnName, row) => {
    if (LINK_COLUMN_NAMES.includes(columnName)) {
      const urlProp = `${columnName}_url`
      
      // Get URL from the extracted property
      let url = row?.[urlProp] || ''
      
      // Fallback: Try direct extraction if no _url property
      if (!url && typeof value === 'string') {
        const directUrlMatch = value.match(/@\s*(https?:\/\/[^\s]+)/i)
        if (directUrlMatch) {
          url = directUrlMatch[1]
        }
      }
      
      // If we have a valid URL, show as clickable link
      if (url && url.startsWith('http')) {
        return (
          <a 
            href={url}
            target="_blank"
            rel="noopener noreferrer"
            className="text-blue-600 hover:text-blue-800 underline cursor-pointer font-medium"
            title={`Open ${columnName}`}
          >
            @{' '}â–¼
          </a>
        )
      } else if (value && value.trim()) {
        // No URL found but has value - show warning icon
        return (
          <span 
            className="inline-flex items-center text-yellow-600 cursor-pointer hover:text-yellow-800"
            onClick={() => setShowLinkErrorInfo(!showLinkErrorInfo)}
            title="Click for debug info"
          >
            âš ï¸ 
          </span>
        )
      } else {
        return <span>&nbsp;</span>
      }
    }
    
    return <span>{value}</span>
  }

  const handleLogin = (e) => {
    e.preventDefault()
    if (username === ADMIN_USER && password === ADMIN_PASS) {
      sessionStorage.setItem('yoyaku_session', new Date().toISOString())
      setIsLoggedIn(true)
      setUsername('')
      setPassword('')
      setLoginError('')
      fetchData()
    } else {
      setLoginError('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
    }
  }

  const handleLogout = () => {
    sessionStorage.removeItem('yoyaku_session')
    setIsLoggedIn(false)
    setData([])
    setColumns([])
    setFilterText('')
    setStatusFilter(['åˆ©ç”¨è€…ç™»éŒ²æ¸ˆ', 'ç”³è¾¼æ¸ˆ'])
    setHotelFilter('')
    setHidePastDates(true)
  }

  if (!isLoggedIn) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
        <div className="login-card bg-white rounded-xl shadow-lg p-8 w-full max-w-md">
          <h1 className="text-2xl font-bold text-gray-800 mb-2 text-center">ğŸ” ãƒ­ã‚°ã‚¤ãƒ³</h1>
          <p className="text-gray-500 text-sm text-center mb-6">äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
          
          <form onSubmit={handleLogin} className="space-y-4">
            <div>
              <label htmlFor="username" className="block text-sm font-medium text-gray-700 mb-1">
                ãƒ¦ãƒ¼ã‚¶ãƒ¼å
              </label>
              <input
                type="text"
                id="username"
                value={username}
                onChange={(e) => setUsername(e.target.value)}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                placeholder="admin"
                required
              />
            </div>
            
            <div>
              <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">
                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
              </label>
              <input
                type="password"
                id="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                required
              />
            </div>
            
            {loginError && (
              <div className="bg-red-50 text-red-600 text-sm p-3 rounded-lg">
                {loginError}
              </div>
            )}
            
            <button
              type="submit"
              className="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium"
            >
              ãƒ­ã‚°ã‚¤ãƒ³
            </button>
          </form>
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <header className="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <h1 className="text-xl md:text-2xl font-bold text-gray-800">ğŸ“‹ äºˆç´„ä¸€è¦§</h1>
            <button
              onClick={handleLogout}
              className="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition"
            >
              ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            </button>
          </div>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 py-6">
        {/* Debug panel - only show if requested */}
        {showLinkErrorInfo && (
          <div className="mb-4 bg-yellow-50 border border-yellow-300 rounded-lg p-4">
            <h3 className="font-bold text-lg mb-2">ğŸ” Link URL Debug Info</h3>
            <div className="space-y-2 text-sm">
              {LINK_COLUMN_NAMES.map(colName => {
                const urlProp = `${colName}_url`
                const hasAnyUrl = data.some(d => d[urlProp])
                const sampleUrls = data.slice(0, 3).map((d, i) => 
                  `<strong>Row ${i+1}:</strong> "${d[urlProp] || '(none)'}"`
                ).join('<br>')
                
                return (
                  <div key={colName} className="border-b border-yellow-200 pb-2 last:border-0">
                    <p><strong>{colName}</strong></p>
                    <p>Has {urlProp}: {hasAnyUrl ? 'âœ…' : 'âŒ'}</p>
                    <div dangerouslySetInnerHTML={{ __html: sampleUrls }} />
                  </div>
                )
              })}
            </div>
            <button 
              onClick={() => setShowLinkErrorInfo(false)}
              className="mt-3 px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"
            >
              Close Debug Panel
            </button>
          </div>
        )}
        
        <div className="mb-6 space-y-4">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">æ¤œç´¢</label>
              <input
                type="text"
                placeholder="äºˆç´„è€…ã€ãƒ›ãƒ†ãƒ«åãªã©..."
                value={filterText}
                onChange={(e) => {
                  setFilterText(e.target.value)
                  setCurrentPage(1)
                }}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
              />
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">çŠ¶æ…‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
              <div className="border border-gray-300 rounded-lg p-2 bg-white max-h-48 overflow-y-auto">
                <div 
                  className={`p-2 cursor-pointer rounded ${statusFilter.length === 0 ? 'bg-blue-50' : ''}`}
                  onClick={() => setStatusFilter([])}
                >
                  <span className="text-sm">ã™ã¹ã¦ ({data.length})</span>
                </div>
                {statuses.map((status, idx) => {
                  const count = data.filter(d => d['çŠ¶æ…‹'] === status).length
                  const isSelected = statusFilter.includes(status)
                  return (
                    <div
                      key={idx}
                      className={`p-2 cursor-pointer rounded ${isSelected ? 'bg-blue-100' : 'hover:bg-gray-50'}`}
                      onClick={() => setStatusFilter(prev =>
                        prev.includes(status)
                          ? prev.filter(s => s !== status)
                          : [...prev, status]
                      )}
                    >
                      <span className="text-sm">{status} ({count})</span>
                    </div>
                  )
                })}
              </div>
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">ãƒ›ãƒ†ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</label>
              <select
                value={hotelFilter}
                onChange={(e) => {
                  setHotelFilter(e.target.value)
                  setCurrentPage(1)
                }}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition bg-white"
              >
                <option value="">ã™ã¹ã¦è¡¨ç¤º</option>
                {hotels.map((hotel, idx) => (
                  <option key={idx} value={hotel}>{hotel}</option>
                ))}
              </select>
            </div>
          </div>
          
          <div className="flex items-center justify-between flex-wrap gap-4">
            <label className="flex items-center cursor-pointer space-x-2">
              <input
                type="checkbox"
                checked={hidePastDates}
                onChange={(e) => {
                  setHidePastDates(e.target.checked)
                  setCurrentPage(1)
                }}
                className="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
              />
              <span className="text-sm font-medium text-gray-700">éå»åˆ†éè¡¨ç¤º</span>
            </label>
            
            {/* Debug button */}
            <button
              onClick={() => setShowLinkErrorInfo(!showLinkErrorInfo)}
              className={`px-4 py-2 rounded-lg transition ${
                showLinkErrorInfo 
                  ? 'bg-yellow-500 text-white' 
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              ğŸ” Link Debug
            </button>
            
            <button
              onClick={fetchData}
              disabled={loading}
              className="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50 flex items-center gap-2"
            >
              <svg className={`w-5 h-5 ${loading ? 'animate-spin' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              æ›´æ–°
            </button>
            
            <div className="text-sm text-gray-600 whitespace-nowrap">
              åˆè¨ˆ {filteredData.length} ä»¶ / {data.length} ä»¶ä¸­ | ãƒšãƒ¼ã‚¸ {currentPage} / {totalPages || 1}
            </div>
          </div>
        </div>

        {loading ? (
          <div className="bg-white rounded-lg shadow p-12 text-center">
            <div className="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
            <p className="text-gray-600">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        ) : data.length === 0 ? (
          <div className="bg-white rounded-lg shadow p-12 text-center">
            <p className="text-gray-600">ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚</p>
          </div>
        ) : (
          <>
            <div className="table-container bg-white rounded-lg shadow overflow-hidden">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50 sticky top-0">
                  <tr>
                    {columns.map((col, idx) => (
                      <th key={idx} className="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider whitespace-nowrap">
                        {col}
                      </th>
                    ))}
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {paginatedData.map((row) => (
                    <tr key={row._id} className="hover:bg-gray-50 transition">
                      {columns.map((col, colIndex) => (
                        <td key={colIndex} className="px-3 py-3 text-sm text-gray-700 whitespace-nowrap">
                          {renderCell(row[col], col, row)}
                        </td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {totalPages > 1 && (
              <div className="flex items-center justify-between mt-4">
                <button
                  onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                  disabled={currentPage === 1}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  â† å‰ã¸
                </button>
                
                <span className="text-sm text-gray-600">
                  {((currentPage - 1) * rowsPerPage + 1)} - {Math.min(currentPage * rowsPerPage, filteredData.length)} / {filteredData.length}
                </span>
                
                <button
                  onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}
                  disabled={currentPage === totalPages}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  æ¬¡ã¸ â†’
                </button>
              </div>
            )}
          </>
        )}
      </main>

      <footer className="mt-8 py-6 text-center text-sm text-gray-500">
        <p>Â© 2026 äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  | Powered by Cloudflare Pages</p>
      </footer>
    </div>
  )
}

export default App
